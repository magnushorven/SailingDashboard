<!doctype html>
<style>
    html, body {
        background-color: #3d3d3d;
        display: flex;
        align-items: center;
        justify-content: center;
        height: 100%;
        position: relative;
        margin: 0;
    }
    .progress-ring {
        margin: 5vw;
        width: 90vw;
        height: 90vw;
    }
    #speedometer {
        position: absolute;
        top: 40vm;
        width: 100vw;
        text-align: center;
        font-family: 'Open Sans', sans-serif;
        color: #fff;
        font-size: 72;
        font-weight: 700;
    }
    .progress-ring__circle {
        transition: stroke-dashoffset 0.35s;
        transform: rotate(-90deg);
        transform-origin: 50% 50%,
    }
</style>
<html>
    <head>
        <link rel="preconnect" href="https://fonts.gstatic.com">
        <link href="https://fonts.googleapis.com/css2?family=Open+Sans&display=swap" rel="stylesheet">
    </head>
    <body>
        <div id="speedometer">60</div>
        <svg class="progress-ring">
        <circle
            class="progress-ring__circle"
            stroke="white"
            stroke-width="8"
            fill="transparent"
            r="40vw"
            cx="40vw"
            cy="40vw"/>
        </svg>
    </body>
</html>

<script>
    let connected = false,
        error;
    let speed = 0;
    // http://www.websocket.org/echo.html

    var speedometer = document.querySelector("#speedometer"),
        // wsUri = "ws://echo.websocket.org/",
        wsUri = "ws://127.0.0.1/",
        websocket = new WebSocket(wsUri);

    websocket.onopen = function (e) {
        connected = true;
    };

    websocket.onclose = function (e) {
        connected = false;
    };

    websocket.onmessage = function (e) {
        speed = e.data;
        setProgress(speed);
    };

    websocket.onerror = function (e) {
        error = e.data;
    };
    
    var circle = document.querySelector('circle');
    var radius = circle.r.baseVal.value;
    var circumference = radius * 2 * Math.PI;

    circle.style.strokeDasharray = `${circumference} ${circumference}`;
    circle.style.strokeDashoffset = `${circumference}`;

    function setProgress(percent) {
        const offset = circumference - percent / 100 * circumference;
        circle.style.strokeDashoffset = offset;
        speedometer.value = percent;
    }
</script>