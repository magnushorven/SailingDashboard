<!doctype html>

<style>
    html, body {
        display: flex;
        align-items: center;
        justify-content: center;
        height: 100%;
        position: relative;
        margin: 0;
    }
    body {
        background-color: #3d3d3d;
        transition: background 1s;
    }
    .done {
        background-color: #006118 !important;
    }
    .progress-ring {
        position: absolute;
        top: 5vw;
        width: 90vw;
        height: 90vw;
    }
    #speedometer {
        position: absolute;
        top: 36vw;
        width: 100vw;
        text-align: center;
        font-family: 'Open Sans', sans-serif;
        color: #fff;
        font-size: 72px;
        font-weight: 700;
    }
    #progress {
        position: absolute;
        top: 100vw;
        width: 100vw;
        text-align: center;
        font-family: 'Open Sans', sans-serif;
        color: #fff;
        font-size: 46px;
        font-weight: 500;
    }
    .progress-ring__circle {
        transition: stroke-dashoffset 0.35s;
        transform: rotate(-90deg);
        transform-origin: 50% 50%;
    }
</style>
<html>
    <head>
        <link rel="preconnect" href="https://fonts.gstatic.com">
        <link href="https://fonts.googleapis.com/css2?family=Open+Sans&display=swap" rel="stylesheet">
        <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">
        <script src="https://js.pusher.com/7.0/pusher.min.js"></script>
    </head>
    <body class="done">
        <div id="speedometer">rdy</div>
        <svg class="progress-ring">
        <circle
            class="progress-ring__circle"
            stroke="white"
            stroke-width="20"
            fill="transparent"
            r="150"
            cx="44vw"
            cy="44vw"/>
        </svg>
        <div id="progress">0/0</div>
    </body>
</html>

<script>
    let speed = 0;

    var speedometer = document.querySelector("#speedometer"),
        progress = document.querySelector("#progress");
    
    var circle = document.querySelector('circle'),
        htmlbody = document.querySelector('body');
    var radius = circle.r.baseVal.value;
    var circumference = radius * 2 * Math.PI;

    circle.style.strokeDasharray = `${circumference} ${circumference}`;
    circle.style.strokeDashoffset = `${circumference}`;

    function setSpeed(percent) {
        if (!percent || percent === "0") {
            percent = 0;
        }

        console.log("setSpeed(percent)", percent);
        const offset = circumference - percent / 100 * circumference;
        circle.style.strokeDashoffset = offset;
        if (percent === 0) {
            speedometer.innerHTML = 'done';
            !htmlbody.classList.contains('done') ? htmlbody.classList.add('done') : null;
        } else {
            speedometer.innerHTML = percent;
            htmlbody.classList.contains('done') ? htmlbody.classList.remove('done') : null;
        }
    }

    function setProgress(current, total) {
        progress.innerHTML = (current + 1) + ' / ' + total;
    }

    Pusher.logToConsole = true;

    var pusher = new Pusher('133f7934f1d34407323a', {
      cluster: 'eu'
    });

    var channel = pusher.subscribe('my-channel');
    channel.bind('my-event', function(data) {
        setSpeed(data.message);
        setProgress(data.current, data.total);
    });
</script>