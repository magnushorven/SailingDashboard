<!doctype html>

<style>
    html, body {
        background-color: #3d3d3d;
        display: flex;
        align-items: center;
        justify-content: center;
        height: 100%;
        position: relative;
        margin: 0;
    }
    .progress-ring {
        position: absolute;
        top: 5vw;
        width: 90vw;
        height: 90vw;
    }
    #speedometer {
        position: absolute;
        top: 36vw;
        width: 100vw;
        text-align: center;
        font-family: 'Open Sans', sans-serif;
        color: #fff;
        font-size: 72px;
        font-weight: 700;
    }
    .progress-ring__circle {
        transition: stroke-dashoffset 0.35s;
        transform: rotate(-90deg);
        transform-origin: 50% 50%;
    }
</style>
<html>
    <head>
        <link rel="preconnect" href="https://fonts.gstatic.com">
        <link href="https://fonts.googleapis.com/css2?family=Open+Sans&display=swap" rel="stylesheet">
        <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">
        <script src="https://js.pusher.com/7.0/pusher.min.js"></script>
    </head>
    <body>
        <div id="speedometer">0</div>
        <svg class="progress-ring">
        <circle
            class="progress-ring__circle"
            stroke="white"
            stroke-width="20"
            fill="transparent"
            r="150"
            cx="44vw"
            cy="44vw"/>
        </svg>
    </body>
</html>

<script>
    let speed = 0;

    var speedometer = document.querySelector("#speedometer");
    
    var circle = document.querySelector('circle');
    var radius = circle.r.baseVal.value;
    var circumference = radius * 2 * Math.PI;

    circle.style.strokeDasharray = `${circumference} ${circumference}`;
    circle.style.strokeDashoffset = `${circumference}`;

    function setProgress(percent) {
        if (!percent) {
            percent = 0;
        }
        console.log("setProgress(percent)", percent);
        const offset = circumference - percent / 100 * circumference;
        circle.style.strokeDashoffset = offset;
        speedometer.innerHTML = percent;
    }

    Pusher.logToConsole = true;

    var pusher = new Pusher('133f7934f1d34407323a', {
      cluster: 'eu'
    });

    var channel = pusher.subscribe('my-channel');
    channel.bind('my-event', function(data) {
      setProgress(data.message);
    });
</script>